# üê≥ Contedores  
**Posta en Produci√≥n Segura ‚Äì Unidade 4**

## üìã √çndice
- Introduci√≥n
- Motivaci√≥n e historia
- Vantaxes
- Inconvenientes
- Ciberseguridade e contedores
- Tecnolox√≠as actuais
- Comparativa Docker/Podman

---

## üï∞Ô∏è Motivaci√≥n e Historia

- Resolver incompatibilidades entre contornos.
- Primeiros pasos:
  - `chroot` (1979)
  - FreeBSD Jails (2000)
  - OpenVZ (2005)
  - LXC (2008)
  - LXD (2015)
- Docker populariza os contedores en 2013.

---

## ‚úÖ Vantaxes dos contedores

- Lixeireza e velocidade
- Portabilidade entre contornos
- Illamento de procesos
- Escalabilidade e integraci√≥n con CI/CD

---

## ‚ö†Ô∏è Inconvenientes dos contedores

- Menor illamento c√≥s hipervisores
- Posibles riscos de seguridade
- Xesti√≥n complexa de volumes/persistencia
- Dependencia do kernel Linux

---

## üîê Ciberseguridade e contedores

**Riscos:**
- Container escape
- Imaxes inseguras
- Permisos excesivos

**Medidas:**
- Escaneo con `Trivy`, `Clair`
- Execuci√≥n sen root
- Uso de `AppArmor`, `SELinux`

---

## üîß Tecnolox√≠as actuais

- **Docker**: contedores lixeiros e populares
- **Podman**: alternativa sen daemon
- **LXC / LXD**: m√°is preto dunha VM
- **Kubernetes**: orquestraci√≥n
- **containerd, CRI-O**: motores backend

---

## ‚öñÔ∏è Comparativa Docker vs Podman

---

## üîç Conceptos b√°sicos

**Contedor** ‚Üí Proceso empaquetado illado  
- Instancia executable dunha imaxe  
- Pode crearse, iniciarse, deter, moverse ou eliminarse  
- Execuci√≥n local ou na nube  
- Portable e illado

**Imaxe** ‚Üí Modelo para crear contedores  
- Sistema de ficheiros illado  
- Orixe: DockerHub ou Dockerfile

---

## üíª Instalaci√≥n de Docker

### En Windows
- Instalar WSL
- Instalar Docker Desktop
- Engadir usuario ao grupo `docker-users`

```bash
wsl --install -d ubuntu
```

---

### En Ubuntu

```bash
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg lsb-release

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io

sudo usermod -aG docker $USER
```

Verificaci√≥n:

```bash
docker run hello-world
```

---

## üì¶ Comandos b√°sicos de Docker

### üì• Imaxes

```bash
docker pull nome_imaxe
docker image ls
docker image rm nome_imaxe
```

### üöÄ Contedores

```bash
docker run nome_imaxe
docker run -d nome_imaxe
docker run --name nome_contedor nome_imaxe
docker run -p 8080:80 nome_imaxe
```

```bash
docker ps -a
docker start nome
docker stop nome
docker rm -f nome
```

---

### üåê Redes

```bash
docker network ls
docker network create nome
docker network rm nome
docker network inspect nome
```

---

### üíæ Volumes

- Xestionados por Docker (`/var/lib/docker/volumes/`)
- **Bind mounts**: directorio do host ‚Üí contedor
- **tmpfs**: montaxe temporal en RAM (Linux)

```bash
docker volume create nome
docker volume rm nome
docker volume inspect nome
docker run -v nome:/ruta nome_imaxe
docker run -v /host:/contedor nome_imaxe
```

---

## üõ†Ô∏è Dockerfile

```Dockerfile
FROM debian
RUN apt-get update && apt-get install -y apache2 && apt-get clean && rm -rf /var/lib/apt/lists/*
ENV APACHE_RUN_USER=www-data
ENV APACHE_RUN_GROUP=www-data
ENV APACHE_LOG_DIR=/var/log/apache2
EXPOSE 80
ADD ["index.html", "/var/www/html/"]
ENTRYPOINT ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]
```

Constru√≠r a imaxe:

```bash
docker build -t nome_imaxe:tag .
```

---

## üì¶ Docker Compose

- Arquivo `docker-compose.yml`
- Define m√∫ltiples contedores e servizos

**Etiquetas com√∫ns:**
- `image`, `container_name`, `hostname`
- `environment`, `ports`, `volumes`, `networks`, `command`

**Outras secci√≥ns:**
- `volumes`: definir volumes globais
- `networks`: definir redes

**Comandos:**

```bash
docker compose up
docker compose up -d
docker compose -f arquivo.yml up
docker compose down
docker compose -f arquivo.yml down
docker logs -f nome_contedor
```

---

## Consideraci√≥ns de seguridade
Imos ver algunhas ferramentas en boas pr√°cticas relacionadas coa seguridade √° hora de traballar con contedores:
### Ferramentas
1. **Docker Scout**
  - Integraci√≥n nativa na CLI de Docker
  - Aval√≠a vulnerabilidades das capas dunha imaxe (CVE).
  - Ofrece recomendaci√≥ns de imaxes alternativas m√°is seguras.
  - Integraci√≥n con *GitHub* e *DockerHub*.
  - Exemplo de uso:
```bash
docker scout cve nome_imaxe
```
2. **Trivy (Aqua Security)**
  - Escanea imaxes, contedores en execuci√≥n, repositos, configuraci√≥ns de Kubernetes, etc.
  - Detecta:
    - CVEs en paquetes do sistema..
    - Problemas en dependencias de aplicaci√≥ns (Python, Node, etc.).
    - Secrets expostos (tokens, claves‚Ä¶).
    - Configuraci√≥ns inseguras.
  - Exemplo de uso:
```bash
trivy image nome_imaxe
```
3. **Grype (Anchore)**
  - Semellante a *Trivy*.
  - Analiza imaxes para obter vulnerabilidades.
  - Exemplo de uso:
```bash
grype nome_imaxe
```
### Boas pr√°cticas
#### Durante a construci√≥n:
- Usa imaxes base seguras actualizadas.
- Minimiza o n√∫mero de capas e de paquetes instalados.
- Borra a cach√© de apt, ficheiros temporais e usuarios innecesarios.
- Evita executar como root dentro do contedor.
```bash
RUN adduser --disabled-password appuser
USER appuser
```
- Non gardar secrets nin contrasinais no Dockerfile.
#### Durante o despregue:
- Usa sistemas de arquivos de s√≥ lectura cando sexa posible.
- Limita capacidades do contedor (*cap_drop*, *no-new-privileges* e *security_opt*).
- Asegura que os contedores non te√±an acceso innecesario √° rede, volumes ou outros contedores.
Habilita escaneado autom√°tico no rexistro.

## üìö Referencias

- [Podman Docs](https://docs.podman.io/en/latest/Reference.html)  
- [Docker primeiros pasos](https://docs.docker.com/get-started/)  
- [Docker Compose](https://docs.docker.com/compose/gettingstarted/)  
- [Dockerfile](https://docs.docker.com/reference/dockerfile/)